<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>API регистрации контрагентов ABMotors</title>
  <link rel="stylesheet" type="text/css" href="./swagger-ui.css" />
  <script src="https://cdnjs.cloudflare.com/ajax/libs/js-yaml/4.1.0/js-yaml.min.js"></script>
  <style>
    html { box-sizing: border-box; overflow: -moz-scrollbars-vertical; overflow-y: scroll; }
    *, *:before, *:after { box-sizing: inherit; }
    body { margin:0; background: #fafafa; }
  </style>
</head>

<body>
  <div id="swagger-ui"></div>

  <script src="./swagger-ui-bundle.js"></script>
  <script src="./swagger-ui-standalone-preset.js"></script>
  <script>
  window.onload = function() {
    const yamlSpec = `
openapi: 3.0.3
info:
  title: API регистрации контрагентов ABMotors
  description: API для регистрации новых контрагентов
  version: 1.0.0
  contact:
    name: ABMotors Ilin M
    email: m.ilin@avto-belogorie.ru

servers:
  - url: http://178.185.225.118
    description: Production server

paths:
  /alpha_api/hs/nona/register:
    post:
      summary: Регистрация физического лица
      description: |
        Регистрирует нового пользователя или находит существующего по номеру телефона.
        При регистрации автоматически создается бонусная карта и начисляются приветственные баллы.
        При входе проходит проверку наличия бонусной карты и приветственных баллов, регистрирует в случае их отсутствия
      tags:
        - Физические лица
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - phone
                - lname
                - fname
                - sname
                - birthday
                - sex
              properties:
                phone:
                  type: string
                  description: Номер телефона для регистрации/поиска
                  example: '78005553535'
                  minLength: 10
                  maxLength: 11
                lname:
                  type: string
                  description: Фамилия пользователя
                  example: "Ильин"
                  minLength: 1
                  maxLength: 50
                fname:
                  type: string
                  description: Имя пользователя
                  example: "Максим"
                  minLength: 1
                  maxLength: 50
                sname:
                  type: string
                  description: Отчество пользователя
                  example: "Сергеевич"
                  minLength: 1
                  maxLength: 50
                birthday:
                  type: string
                  description: Дата рождения в формате ГГГГ.ММ.ДД
                  example: "1997.03.28"
                  pattern: '^[0-9]{4}\.[0-9]{2}\.[0-9]{2}$'
                sex:
                  type: string
                  description: Пол пользователя
                  enum:
                    - male
                    - female
                  example: male
            examples:
              minimalData:
                summary: Минимальные данные для регистрации
                value:
                  phone: "78005553535"
                  lname: "Ильин"
                  fname: "Максим"
                  sname: "Сергеевич"
                  birthday: "1997.03.28"
                  sex: "male"
      responses:
        '201':
          description: Пользователь успешно зарегистрирован
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    description: Флаг успешного выполнения
                    example: true
                  number:
                    type: string
                    description: Номер клиента в базе
                    example: "12345"
                  hasWelcomePoints:
                    type: boolean
                    description: Начислены ли приветственные баллы
                    example: true
              examples:
                success:
                  summary: Успешная регистрация нового пользователя
                  value:
                    success: true
                    number: "12345"
                    hasWelcomePoints: true
        '200':
          description: Пользователь найден в системе
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  number:
                    type: string
                    example: "67890"
                  hasWelcomePoints:
                    type: boolean
                    example: false
              examples:
                existingUser:
                  summary: Успешный вход существующего пользователя
                  value:
                    success: true
                    number: "67890"
                    hasWelcomePoints: false
        '400':
          description: Ошибка валидации входных данных
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: false
                  message:
                    type: string
                    example: "Не заполнены обязательные реквизиты"
        '503':
          description: Серверная ошибка при обработке запроса
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: false
                  message:
                    type: string
                    example: "Не удалось зарегистрировать контрагента на сервере!"
  /alpha_api/hs/nona/appointments:
    get:
      summary: Получить онлайн записи на сервис
      description: |
        Получить записи на сервис
      tags:
        - Онлайн записи на сервис (Схема валидная?)
      operationId: getSchedules
      responses:
        '200':
          description: Успешный ответ с расписанием станций
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SchedulesResponse'
components:
  schemas:
    StationSchedule:
      type: object
      required:
        - station
        - city
        - records
      properties:
        station:
          type: string
          description: Идентификатор станции
          example: "station_101"
        city:
          type: string
          description: Идентификатор города
          example: "city_1"
        records:
          type: array
          description: Список временных слотов обслуживания
          items:
            $ref: '#/components/schemas/TimeWindow'
    TimeWindow:
      type: object
      required:
        - service_from
        - service_to
        - status
      properties:
        service_from:
          type: string
          description: Дата и время начала обслуживания в формате DD.MM.YYYY HH:mm
          example: "07.11.2025 08:00"
        service_to:
          type: string
          description: Дата и время окончания обслуживания в формате DD.MM.YYYY HH:mm
          example: "07.11.2025 12:00"
        status:
          type: string
          description: Статус временного слота
          enum:
            - free
            - lock
          example: "free"

    Metadata:
      type: object
      properties:
        cities:
          type: object
          additionalProperties:
            type: string
          description: Соответствие идентификаторов городов их названиям
          example:
            city_1: "Белгород"
            city_2: "Старый Оскол"
        stations:
          type: object
          additionalProperties:
            type: string
          description: Соответствие идентификаторов станций их названиям
          example:
            station_101: "EXEED"
            station_102: "LADA"
            station_201: "OMODA"
    SchedulesResponse:
      type: array
      items:
        oneOf:
          - $ref: '#/components/schemas/StationSchedule'
          - $ref: '#/components/schemas/Metadata'
      description: Массив, содержащий расписания станций и метаданные
      example:
        - station: "station_101"
          city: "city_1"
          records:
            - service_from: "07.11.2025 08:00"
              service_to: "07.11.2025 12:00"
              status: "lock"
            - service_from: "07.11.2025 12:00"
              service_to: "07.11.2025 16:00"
              status: "free"
            - service_from: "07.11.2025 16:00"
              service_to: "07.11.2025 20:00"
              status: "lock"  
        - station: "station_102"
          city: "city_1"
          records:
            - service_from: "07.11.2025 08:00"
              service_to: "07.11.2025 12:00"
              status: "free"
            - service_from: "07.11.2025 12:00"
              service_to: "07.11.2025 16:00"
              status: "free"
            - service_from: "07.11.2025 16:00"
              service_to: "07.11.2025 20:00"
              status: "lock"  
        - station: "station_201"
          city: "city_2"
          records:
            - service_from: "07.11.2025 08:00"
              service_to: "07.11.2025 12:00"
              status: "free"
            - service_from: "07.11.2025 12:00"
              service_to: "07.11.2025 16:00"
              status: "lock"
            - service_from: "07.11.2025 16:00"
              service_to: "07.11.2025 20:00"
              status: "lock"  
        - cities:
            city_1: "Белгород"
            city_2: "Старый Оскол"
          stations:
            station_101: "EXEED"
            station_102: "LADA"
            station_201: "OMODA"
    `;

    const spec = jsyaml.load(yamlSpec);
    
    window.ui = SwaggerUIBundle({
      spec: spec,
      dom_id: '#swagger-ui',
      deepLinking: true,
      presets: [
        SwaggerUIBundle.presets.apis,
        SwaggerUIStandalonePreset
      ],
      plugins: [
        SwaggerUIBundle.plugins.DownloadUrl
      ],
      layout: "StandaloneLayout",
      supportedSubmitMethods: ['get', 'post', 'put', 'delete', 'patch'],
      validatorUrl: null
    });
  }
  </script>
</body>
</html>